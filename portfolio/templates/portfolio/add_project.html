{% extends "base.html" %}
{% block title %}Add Project{% endblock %}

{% block content %}
<h1 class="mb-4">Add New Project</h1>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <div class="mb-3">{{ form.title.label_tag }}{{ form.title }}</div>
  <div class="mb-3">{{ form.description.label_tag }}{{ form.description }}</div>
  <div class="mb-3">{{ form.link.label_tag }}{{ form.link }}</div>

  <div class="mb-3">
    {{ form.image.label_tag }}
    <input type="file" id="id_image" name="image" accept="image/*" class="form-control">

    <div class="mt-3">
      <img id="imagePreview" class="img-fluid d-none" style="max-height: 400px;">
    </div>
  </div>

  <button type="submit" class="btn btn-success">Submit</button>
  <a href="{% url 'portfolio_index' %}" class="btn btn-secondary">Cancel</a>
</form>
{% endblock %}

{% block extra_head %}
<style>
  .cropper-container {
    max-width: 100%;
  }
</style>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const imageInput = document.getElementById("id_image");
  const preview = document.getElementById("imagePreview");
  let cropper;

  imageInput.addEventListener("change", function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();

      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.classList.remove("d-none");

        if (cropper) {
          cropper.destroy();
        }

        cropper = new Cropper(preview, {
          aspectRatio: 16 / 9,
          viewMode: 1,
          autoCropArea: 1,
          responsive: true,
        });
      };

      reader.readAsDataURL(file);
    } else {
      preview.classList.add("d-none");
    }
  });
});
</script>
{% endblock %}
